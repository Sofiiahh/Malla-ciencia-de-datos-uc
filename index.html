<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Interactiva — Ciencia de Datos</title>
<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  padding:20px;
  background:#fafafa;
  color:#222;
}
h1,h2,h3{
  text-align:center;
  font-weight:800;
}
.controls{
  text-align:center;
  margin:20px 0;
}
.sem-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:14px;
}
.sem-box{
  padding:10px;
  border-radius:12px;
  color:#000;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.course{
  background:white;
  padding:8px;
  margin:5px 0;
  border-radius:8px;
  cursor:pointer;
  border:2px solid transparent;
}
.course.aprobado{
  background:#2ECC71;
  color:white;
  text-decoration:line-through;
}
.course.desbloqueado{
  background:#FFB6C1;
}
.course.bloqueado{
  background:#ddd;
}
.plan-box{
  margin-top:25px;
  padding:15px;
  background:white;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>

<body>

<h1>Malla Interactiva — Ciencia de Datos</h1>

<div class="controls">
  <label>Máximo de ramos por semestre:
    <select id="maxSem">
      <option value="4">4</option>
      <option value="5" selected>5</option>
      <option value="6">6</option>
    </select>
  </label>
  &nbsp;&nbsp;&nbsp;
  <label>Tu semestre actual:
    <select id="semNow">
      <script>
        for(let i=1;i<=8;i++) document.write(`<option value="${i}">${i}</option>`);
      </script>
    </select>
  </label>
</div>

<div id="malla" class="sem-grid"></div>

<h2>Plan recomendado</h2>
<div id="plan" class="plan-box"></div>

<h2>Plan de acción</h2>
<div id="accion" class="plan-box"></div>

<script>
// ---------------------- DATOS DE RAMOS ----------------------

const R = {
  IC1103:{n:'Introducción a la Programación',sem:1,pr:[]},
  MAT1107:{n:'Introducción al Cálculo',sem:1,pr:[]},
  MAT1207:{n:'Introducción al Álgebra y Geometría',sem:1,pr:[]},
  MAT0007:{n:'Taller de Matemáticas',sem:1,pr:[]},
  OFG1:{n:'OFG',sem:1,pr:[]},

  IIC2233:{n:'Programación Avanzada',sem:2,pr:['IC1103']},
  MAT1610:{n:'Cálculo I',sem:2,pr:['MAT1107']},
  IMT2210:{n:'Álgebra Lineal para Ciencia de Datos',sem:2,pr:['IC1103','MAT1107','MAT1207']},
  IMT2200:{n:'Introducción a Ciencia de Datos',sem:2,pr:['IC1103','MAT1207']},
  OFG2:{n:'OFG',sem:2,pr:[]},

  IMT2220:{n:'Cálculo para Ciencia de Datos',sem:3,pr:['MAT1610']},
  IMT2230:{n:'Álgebra Lineal Avanzada y Modelamiento',sem:3,pr:['MAT1610','IMT2210']},
  ETI195:{n:'Ética para Ciencia de Datos y Estadística',sem:3,pr:['IIC2233','IMT2200']},
  IIC1253:{n:'Matemáticas Discretas',sem:3,pr:['IMT2210']},
  OFG3:{n:'OFG',sem:3,pr:[]},

  EYP1025:{n:'Modelos Probabilísticos',sem:4,pr:['IMT2220','IMT2230']},
  IC2133:{n:'Estructuras de Datos y Algoritmos',sem:4,pr:['IIC2233','IIC1253']},
  IC2413:{n:'Bases de Datos',sem:4,pr:['IIC2233','IIC1253']}, // ← CORREGIDO
  IMT2250:{n:'Optimización para Ciencia de Datos',sem:4,pr:['IMT2220','IMT2210']},
  OFG4:{n:'OFG',sem:4,pr:[]},

  EYP2114:{n:'Inferencia Estadística',sem:5,pr:['EYP1025']},
  IIC2613:{n:'Inteligencia Artificial',sem:5,pr:['EYP1025','IIC2233']},
  LIC2440:{n:'Procesamiento de Datos Masivos',sem:5,pr:['IC2413','IC2133']},
  OPR5:{n:'OPR o Minor',sem:5,pr:[]},
  OFG5:{n:'OFG',sem:5,pr:[]},

  EYP2101:{n:'Procesos Estocásticos Aplicados',sem:6,pr:['EYP2114']},
  EYP2301:{n:'Análisis de Regresión',sem:6,pr:['EYP2114']},
  C2026:{n:'Visualización de la Información',sem:6,pr:['IC1103']},
  IIC2433:{n:'Minería de Datos',sem:6,pr:['IC1103','EYP1025','IMT2210']},
  OFG6:{n:'OFG',sem:6,pr:[]},

  EYP2111:{n:'Simulación',sem:7,pr:['EYP2101']},
  EYP2801:{n:'Métodos Bayesianos',sem:7,pr:['EYP2114']},
  IMT2260:{n:'Teoría de Aprendizaje Automático',sem:7,pr:['IMT2250','EYP1025']}, // ← CORREGIDO
  OPR7:{n:'OPR o Minor',sem:7,pr:[]},
  OFG7:{n:'OFG',sem:7,pr:[]},

  IMT2270:{n:'Proyecto de Graduación',sem:8,pr:['EYP2801','IMT2260','IMT2250','ETI195']},
  OPR81:{n:'OPR o Minor',sem:8,pr:[]},
  OPR82:{n:'OPR o Minor',sem:8,pr:[]},
  OPR83:{n:'OPR o Minor',sem:8,pr:[]},
  OFG8:{n:'OFG',sem:8,pr:[]},
};

const semColors = [
  '#FDE2E4','#FAD2E1','#E2ECE9','#D6E5FA',
  '#FFF1C9','#FFE6A7','#E2F0CB','#F6EEC7'
];

let aprobados = [];

// ---------------------- FUNCIONES ----------------------

function canTake(code){
  return R[code].pr.every(p=>aprobados.includes(p));
}

function buildPlan(){
  const max = Number(document.getElementById("maxSem").value);
  const plan = {};
  let taken = [...aprobados];

  for(let s=1; s<=8; s++){
    plan[s] = [];
    let candidates = Object.keys(R).filter(c => 
      R[c].sem===s && !taken.includes(c) && canTake(c)
    );
    for(let c of candidates){
      if(plan[s].length < max){
        plan[s].push(c);
        taken.push(c);
      }
    }
  }
  return plan;
}

function renderMalla(){
  const box = document.getElementById("malla");
  box.innerHTML = "";

  for(let s=1; s<=8; s++){
    const semBox = document.createElement("div");
    semBox.className = "sem-box";
    semBox.style.background = semColors[(s-1)%8];
    semBox.innerHTML = `<h3>Semestre ${s}</h3>`;

    Object.keys(R).filter(c=>R[c].sem===s).forEach(code=>{
      const btn = document.createElement("div");
      const status = aprobados.includes(code)
        ? 'aprobado'
        : canTake(code) ? 'desbloqueado' : 'bloqueado';

      btn.className = `course ${status}`;
      btn.textContent = `[${code}] ${R[code].n}`;
      btn.onclick = ()=>{ 
        if(aprobados.includes(code)){
          aprobados = aprobados.filter(x=>x!==code);
        } else {
          aprobados.push(code);
        }
        refresh();
      };
      semBox.appendChild(btn);
    });

    box.appendChild(semBox);
  }
}

function renderPlan(){
  const plan = buildPlan();
  const div = document.getElementById("plan");
  div.innerHTML = "";

  for(let s=1; s<=8; s++){
    const list = plan[s];
    const box = document.createElement("div");
    box.innerHTML = `<h4>Semestre ${s}</h4>` +
      (list.length ? list.map(c=>`<div>[${c}] ${R[c].n}</div>`).join("")
                   : `<div>—</div>`);
    div.appendChild(box);
  }
}

function renderAccion(){
  const sem = Number(document.getElementById("semNow").value);
  const plan = buildPlan();
  const list = plan[sem];
  const div = document.getElementById("accion");

  if(!list.length){
    div.innerHTML = `<b>Semestre ${sem}:</b> No hay ramos sugeridos.`;
    return;
  }

  div.innerHTML = `<b>Semestre ${sem}:</b><br>` + 
    list.map(c=>`<div>• [${c}] ${R[c].n}</div>`).join("");
}

function refresh(){
  renderMalla();
  renderPlan();
  renderAccion();
}

// ---------------------- START ----------------------

refresh();
document.getElementById("maxSem").onchange = refresh;
document.getElementById("semNow").onchange = refresh;

</script>

</body>
</html>
